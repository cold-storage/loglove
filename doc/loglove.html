<!DOCTYPE html>

<html>
<head>
  <title>loglove</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h1 id="loglove">loglove</h1>
<p>A simple logging facility for node.js. We hope you love us.</p>
<p>Most important is the ability to configure different loggers with
different levels and the ability to change configuration at runtime.</p>
<p>To easily configure both a logger and its descendents,
name your loggers with path notation like
<code>&quot;/some/cool/logger&quot;</code>. Often you will use the source
file name like so.</p>
<pre><code>loglove = require(&#39;loglove&#39;)
log = loglove.getLog(__filename)</code></pre>
<p>Next most important are formatters that allow you to decorate your log
messages with timestamp, level, etc.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="keyword">var</span> fmt = require(<span class="string">'util'</span>).format,
  formatter = <span class="function"><span class="keyword">function</span><span class="params">(name, msg, level)</span> {</span>
    <span class="keyword">return</span> fmt(JSON.stringify(<span class="keyword">new</span> Date()).slice(<span class="number">1</span>, -<span class="number">1</span>), level, name, msg);
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h2 id="constructor">Constructor</h2>
<p>NOTE: If you are using __filename to name your loggers, you will probably
want to set the LOG_LOVE_ROOT_PATH environment variable before starting
your app so your logger names are relative to your app&#39;s root path.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="keyword">function</span> <span class="title">Log</span><span class="params">(name, level)</span> {</span>
  <span class="keyword">var</span> rootPath = process.env.LOG_LOVE_ROOT_PATH || <span class="string">''</span>;
  <span class="keyword">this</span>.name = name.substr(rootPath.length);
  <span class="keyword">this</span>.level = exports[level] || exports.DEFAULT_LEVEL;
  exports.logmap[name] = <span class="keyword">this</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <h2 id="getlog">getLog</h2>
<p>Returns the logger of your dreams. Name is required. Level is optional.
If no level is passed we use the default level which is <code>INFO</code> unless
you have changed it with a prior call to <code>configure()</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>module.exports.getLog = <span class="function"><span class="keyword">function</span> <span class="title">getLog</span><span class="params">(name, level)</span> {</span>
  <span class="keyword">var</span> lgr = <span class="keyword">new</span> Log(name, level);
  exports.logmap[name] = lgr;
  <span class="keyword">return</span> lgr;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <h2 id="setformatter">setFormatter</h2>
<p>Sets the callback function that will be used to format your log messages.
If you don&#39;t set one we use a default. Function will be called with
the arguments <code>loggerName</code>, <code>message</code>, and <code>level</code>.
We assume this will be called once on app startup.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>module.exports.setFormatter = <span class="function"><span class="keyword">function</span> <span class="title">setFormatter</span><span class="params">(cb)</span> {</span>
  formatter = cb;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <h2 id="we-use-syslog-levels-">We use syslog levels.</h2>
<p><a href="http://en.wikipedia.org/wiki/Syslog">http://en.wikipedia.org/wiki/Syslog</a></p>
<p>A log request, <code>log.notice()</code> for example, is considered &quot;enabled&quot; if the
logger&#39;s level is equal to or higher than the request. So a logger with a
level of <code>ERROR</code> will do nothing if you request <code>log.notice()</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.OFF = -<span class="number">1</span>;
exports.EMERGENCY = <span class="number">0</span>;
exports.ALERT = <span class="number">1</span>;
exports.CRITICAL = <span class="number">2</span>;
exports.ERROR = <span class="number">3</span>;
exports.WARNING = <span class="number">4</span>;
exports.NOTICE = <span class="number">5</span>;
exports.INFO = <span class="number">6</span>;
exports.DEBUG = <span class="number">7</span>;
exports.DEFAULT_LEVEL = exports.INFO;</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <h2 id="configure">configure</h2>
<p>Allows for configuration of log levels. Takes a JSON structure
where the key is a path to a logger. The value is the log level.
An asterisk (*) may
be used to denote wildcards and descendents.</p>
<pre><code>{ &quot;/&quot;: &quot;ERROR&quot;, &quot;/some/logger&quot;: &quot;INFO&quot;,
  &quot;/some/descendents/*&quot;: &quot;DEBUG&quot;,
  &quot;/rea*lly/fancy&quot;: &quot;ALERT&quot; }</code></pre>
<p>&quot;/&quot; sets the default level. If you happened to name a logger &quot;/&quot; it
sets that level too. &quot;/*&quot; does not set the default level. It just
sets the levels of all the loggers below /.
NOTE: configure only applies to loggers already constructed. If you
construct a logger after calling configure its level will be the level
you passed in the constructor or the default level if you didn&#39;t pass
anythig.
NOTE: Paths are matched in longest order first. Length is considered
first by number of segments and then by total length. So /a/b/c will be
considered longer than /a/somelongname.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>module.exports.configure = <span class="function"><span class="keyword">function</span><span class="params">(json)</span> {</span>
  <span class="keyword">if</span> (<span class="keyword">typeof</span> json === <span class="string">'string'</span> || json === String) {
    json = JSON.parse(json);
  }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <h2 id="logmap">logmap</h2>
<p>Knows our loggers by name.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.logmap = {};</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <h2 id="prototype">prototype</h2>
<p>Here&#39;s what you can do with a logger.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Log.prototype = {</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <h3 id="__log">__log</h3>
<p>Should not need to call this directly. But knock yourself out if you like.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  __log: <span class="function"><span class="keyword">function</span><span class="params">(level, args)</span> {</span>
    <span class="keyword">if</span> (<span class="keyword">this</span>.level &gt;= exports[level]) {
      msg = fmt.apply(<span class="literal">null</span>, args);
      console.log(formatter(<span class="keyword">this</span>.name, msg, level));
    }
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <h3 id="emergency">emergency</h3>
<p>A &quot;panic&quot; condition usually affecting multiple apps/servers/sites.
At this level it would usually notify all tech staff on call.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  emergency: <span class="function"><span class="keyword">function</span> <span class="title">emergency</span><span class="params">(msg)</span> {</span>
    <span class="keyword">this</span>.__log(<span class="string">'EMERGENCY'</span>, arguments);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <h3 id="alert">alert</h3>
<p>Should be corrected immediately, therefore notify staff who can fix
the problem. An example would be the loss of a primary ISP connection.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  alert: <span class="function"><span class="keyword">function</span> <span class="title">alert</span><span class="params">(msg)</span> {</span>
    <span class="keyword">this</span>.__log(<span class="string">'ALERT'</span>, arguments);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <h3 id="critical">critical</h3>
<p>Should be corrected immediately, but indicates failure in a secondary
system, an example is a loss of a backup ISP connection.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  critical: <span class="function"><span class="keyword">function</span> <span class="title">critical</span><span class="params">(msg)</span> {</span>
    <span class="keyword">this</span>.__log(<span class="string">'CRITICAL'</span>, arguments);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <h3 id="error">error</h3>
<p>Non-urgent failures, these should be relayed to developers or admins;
each item must be resolved within a given time.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  error: <span class="function"><span class="keyword">function</span> <span class="title">error</span><span class="params">(msg)</span> {</span>
    <span class="keyword">this</span>.__log(<span class="string">'ERROR'</span>, arguments);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <h3 id="warning">warning</h3>
<p>Warning messages, not an error, but indication that an error will occur
if action is not taken, e.g. file system 85% full - each item must be
resolved within a given time.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  warning: <span class="function"><span class="keyword">function</span> <span class="title">warning</span><span class="params">(msg)</span> {</span>
    <span class="keyword">this</span>.__log(<span class="string">'WARNING'</span>, arguments);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <h3 id="notice">notice</h3>
<p>Events that are unusual but not error conditions - might be summarized
in an email to developers or admins to spot potential problems
-- no immediate action required.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  notice: <span class="function"><span class="keyword">function</span> <span class="title">notice</span><span class="params">(msg)</span> {</span>
    <span class="keyword">this</span>.__log(<span class="string">'NOTICE'</span>, arguments);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <h3 id="info">info</h3>
<p>Normal operational messages - may be harvested for reporting, measuring
throughput, etc. -- no action required.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  info: <span class="function"><span class="keyword">function</span> <span class="title">info</span><span class="params">(msg)</span> {</span>
    <span class="keyword">this</span>.__log(<span class="string">'INFO'</span>, arguments);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <h3 id="debug">debug</h3>
<p>Info useful to developers for debugging the application, not useful
during operations.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  debug: <span class="function"><span class="keyword">function</span> <span class="title">debug</span><span class="params">(msg)</span> {</span>
    <span class="keyword">this</span>.__log(<span class="string">'DEBUG'</span>, arguments);
  }
};</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
