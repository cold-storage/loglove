<!DOCTYPE html>

<html>
<head>
  <title>loglove</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h1 id="loglove">loglove</h1>
<p>A simple logging facility for node.js. We hope you love us.</p>
<p>Most important is the ability to configure different loggers with
different levels and the ability to change configuration at runtime.</p>
<p>To easily configure both a logger and its descendents,
name your loggers with path notation like
<code>&quot;/some/cool/logger&quot;</code>. Often you will use the source
file name like so.</p>
<pre><code>loglove = require(&#39;loglove&#39;)
log = loglove.log(__filename)</code></pre>
<p>Next most important are formatters that allow you to decorate your log
messages with timestamp, level, etc.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="keyword">var</span> ll = {},
  fmt = require(<span class="string">'util'</span>).format,
  fs = require(<span class="string">'fs'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h2 id="we-use-syslog-levels-">We use syslog levels.</h2>
<p><a href="http://en.wikipedia.org/wiki/Syslog">http://en.wikipedia.org/wiki/Syslog</a></p>
<p>A log request, <code>log.notice()</code> for example, is considered &quot;enabled&quot; if the
logger&#39;s level is equal to or higher than the request. So a logger with a
level of <code>ERROR</code> will do nothing if you request <code>log.notice()</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>ll.OFF = -<span class="number">1</span>;
ll.EMERGENCY = <span class="number">0</span>;
ll.ALERT = <span class="number">1</span>;
ll.CRITICAL = <span class="number">2</span>;
ll.ERROR = <span class="number">3</span>;
ll.WARNING = <span class="number">4</span>;
ll.NOTICE = <span class="number">5</span>;
ll.INFO = <span class="number">6</span>;
ll.DEBUG = <span class="number">7</span>;
ll.DEFAULT_LEVEL = ll.INFO;

ll.levelNames = [];
ll.levelNames[<span class="number">0</span>] = <span class="string">'EMERGENCY'</span>;
ll.levelNames[<span class="number">1</span>] = <span class="string">'ALERT'</span>;
ll.levelNames[<span class="number">2</span>] = <span class="string">'CRITICAL'</span>;
ll.levelNames[<span class="number">3</span>] = <span class="string">'ERROR'</span>;
ll.levelNames[<span class="number">4</span>] = <span class="string">'WARNING'</span>;
ll.levelNames[<span class="number">5</span>] = <span class="string">'NOTICE'</span>;
ll.levelNames[<span class="number">6</span>] = <span class="string">'INFO'</span>;
ll.levelNames[<span class="number">7</span>] = <span class="string">'DEBUG'</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>TODO once we have wildcards in the config, this will get a bit more complex.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="keyword">function</span> <span class="title">determineLevel</span><span class="params">(name, level)</span> {</span>
  <span class="keyword">return</span> ll[ll.config[name]] || ll[level] || ll.DEFAULT_LEVEL;
}

<span class="function"><span class="keyword">function</span> <span class="title">levelName</span><span class="params">(level)</span> {</span>
  <span class="keyword">if</span> (level === -<span class="number">1</span>) {
    <span class="keyword">return</span> <span class="string">'OFF'</span>;
  } <span class="keyword">else</span> {
    <span class="keyword">return</span> ll.levelNames[level];
  }
}</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <h2 id="constructor">Constructor</h2>
<p>NOTE: If you are using __filename to name your loggers, you will probably
want to set the LOG_LOVE_ROOT_PATH environment variable before starting
your app so your logger names are relative to your app&#39;s root path.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="keyword">function</span> <span class="title">Log</span><span class="params">(name, level, noshow)</span> {</span>
  <span class="keyword">if</span> (ll.logmap[<span class="keyword">this</span>.name]) {
    <span class="keyword">return</span> ll.logmap[<span class="keyword">this</span>.name];
  }
  name = name || <span class="string">'/'</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>name of the logger</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">this</span>.name = name.substr(ll.rootPath.length);</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>numeric level, 0, 1, 2, etc.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">this</span>.level = determineLevel(<span class="keyword">this</span>.name, level);</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>string level WARNING, INFO, DEBUG, etc.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">this</span>.levelName = levelName(<span class="keyword">this</span>.level);</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>the last message logged (mostly for unit testing)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">this</span>.message = <span class="literal">null</span>;
  <span class="keyword">this</span>.noshow = noshow || <span class="literal">false</span>;
  ll.logmap[<span class="keyword">this</span>.name] = <span class="keyword">this</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <h2 id="log">log</h2>
<p>Returns the logger of your dreams. Name is required. Level is optional.
If no level is passed we use the default level which is <code>INFO</code> unless
you have changed it with a prior call to <code>configure()</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.log = <span class="function"><span class="keyword">function</span> <span class="title">log</span><span class="params">(name, level, noshow)</span> {</span>
  <span class="keyword">return</span> <span class="keyword">new</span> Log(name, level, noshow);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <h2 id="formatter">formatter</h2>
<p>Sets the callback function that will be used to format your log messages.
If you don&#39;t set one we use a default. Function will be called with
the arguments <code>loggerName</code>, <code>message</code>, and <code>level</code>.
We assume this will be called once on app startup.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.formatter = <span class="function"><span class="keyword">function</span> <span class="title">formatter</span><span class="params">(cb)</span> {</span>
  ll.formatter = cb;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <h2 id="configure">configure</h2>
<p>Allows for configuration of log levels. Takes a JSON structure
where the key is a path to a logger. The value is the log level.
An asterisk (*) may
be used to denote wildcards and descendents.</p>
<pre><code>{ &quot;/&quot;: &quot;ERROR&quot;, &quot;/some/logger&quot;: &quot;INFO&quot;,
  &quot;/some/descendents/*&quot;: &quot;DEBUG&quot;,
  &quot;/rea*lly/fancy&quot;: &quot;ALERT&quot; }</code></pre>
<p>&quot;/&quot; sets the default level. If you happened to name a logger &quot;/&quot; it
sets that level too. &quot;/*&quot; does not set the default level. It just
sets the ll of all the loggers below /.
NOTE: configure only applies to loggers already constructed. If you
construct a logger after calling configure its level will be the level
you passed in the constructor or the default level if you didn&#39;t pass
anythig.
NOTE: Paths are matched in longest order first. Length is considered
first by number of segments and then by total length. So /a/b/c will be
considered longer than /a/somelongname.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.configure = <span class="function"><span class="keyword">function</span><span class="params">(config)</span> {</span>
  <span class="keyword">if</span> (<span class="keyword">typeof</span> config === <span class="string">'string'</span> || config === String) {
    config = JSON.parse(config);
  }
  <span class="keyword">var</span> key, val, logger;
  <span class="keyword">for</span> (key <span class="keyword">in</span> config) {
    val = config[key];
    ll.config[key] = val;
    logger = ll.logmap[key];
    <span class="keyword">if</span> (logger) {
      logger.level = ll[config[key]];
      logger.levelName = levelName(logger.level);
    }
  }
};

exports.toString = <span class="function"><span class="keyword">function</span> <span class="title">toString</span><span class="params">()</span> {</span>
  <span class="keyword">return</span> JSON.stringify({
    rootPath: ll.rootPath,
    config: ll.config,
    logmap: ll.logmap,
    formatter: ll.formatter + <span class="string">''</span>
  });
};

exports.__reset = <span class="function"><span class="keyword">function</span> <span class="title">__reset</span><span class="params">()</span> {</span>
  ll.logmap = {};
  ll.rootPath = process.env.LOG_LOVE_ROOT_PATH || <span class="string">''</span>;
  ll.config = <span class="literal">null</span>;
  <span class="keyword">if</span> (process.env.LOG_LOVE_CONFIG_FILE) {
    <span class="keyword">try</span> {
      ll.config = JSON.parse(fs.readFileSync(process.env.LOG_LOVE_CONFIG_FILE));
    } <span class="keyword">catch</span> (e) {</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>eat it.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    }
  }
  ll.config = ll.config || {};
  exports.configure(ll.config);
  ll.formatter = <span class="function"><span class="keyword">function</span><span class="params">(name, msg, level)</span> {</span>
    <span class="keyword">return</span> fmt(JSON.stringify(<span class="keyword">new</span> Date()).slice(<span class="number">1</span>, -<span class="number">1</span>), level.substr(<span class="number">0</span>, <span class="number">3</span>), name, msg);
  };
};

exports.__reset();</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <h2 id="prototype">prototype</h2>
<p>Here&#39;s what you can do with a logger.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Log.prototype = {</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <h3 id="__log">__log</h3>
<p>Should not need to call this directly. But knock yourself out if you like.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  __log: <span class="function"><span class="keyword">function</span><span class="params">(level, args)</span> {</span>
    <span class="keyword">if</span> (<span class="keyword">this</span>.level &gt;= ll[level]) {
      <span class="keyword">this</span>.message = fmt.apply(<span class="literal">null</span>, args);
      <span class="keyword">this</span>.message = ll.formatter(<span class="keyword">this</span>.name, <span class="keyword">this</span>.message, level);
      <span class="keyword">if</span> (!<span class="keyword">this</span>.noshow) {
        console.log(<span class="keyword">this</span>.message);
      }
    }
  },
  toString: <span class="function"><span class="keyword">function</span> <span class="title">toString</span><span class="params">()</span> {</span>
    <span class="keyword">return</span> <span class="keyword">this</span>.levelName + <span class="keyword">this</span>.name;
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <h3 id="emergency">emergency</h3>
<p>A &quot;panic&quot; condition usually affecting multiple apps/servers/sites.
At this level it would usually notify all tech staff on call.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  emergency: <span class="function"><span class="keyword">function</span> <span class="title">emergency</span><span class="params">(msg)</span> {</span>
    <span class="keyword">this</span>.__log(<span class="string">'EMERGENCY'</span>, arguments);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <h3 id="alert">alert</h3>
<p>Should be corrected immediately, therefore notify staff who can fix
the problem. An example would be the loss of a primary ISP connection.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  alert: <span class="function"><span class="keyword">function</span> <span class="title">alert</span><span class="params">(msg)</span> {</span>
    <span class="keyword">this</span>.__log(<span class="string">'ALERT'</span>, arguments);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <h3 id="critical">critical</h3>
<p>Should be corrected immediately, but indicates failure in a secondary
system, an example is a loss of a backup ISP connection.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  critical: <span class="function"><span class="keyword">function</span> <span class="title">critical</span><span class="params">(msg)</span> {</span>
    <span class="keyword">this</span>.__log(<span class="string">'CRITICAL'</span>, arguments);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <h3 id="error">error</h3>
<p>Non-urgent failures, these should be relayed to developers or admins;
each item must be resolved within a given time.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  error: <span class="function"><span class="keyword">function</span> <span class="title">error</span><span class="params">(msg)</span> {</span>
    <span class="keyword">this</span>.__log(<span class="string">'ERROR'</span>, arguments);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <h3 id="warning">warning</h3>
<p>Warning messages, not an error, but indication that an error will occur
if action is not taken, e.g. file system 85% full - each item must be
resolved within a given time.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  warning: <span class="function"><span class="keyword">function</span> <span class="title">warning</span><span class="params">(msg)</span> {</span>
    <span class="keyword">this</span>.__log(<span class="string">'WARNING'</span>, arguments);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <h3 id="notice">notice</h3>
<p>Events that are unusual but not error conditions - might be summarized
in an email to developers or admins to spot potential problems
-- no immediate action required.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  notice: <span class="function"><span class="keyword">function</span> <span class="title">notice</span><span class="params">(msg)</span> {</span>
    <span class="keyword">this</span>.__log(<span class="string">'NOTICE'</span>, arguments);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <h3 id="info">info</h3>
<p>Normal operational messages - may be harvested for reporting, measuring
throughput, etc. -- no action required.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  info: <span class="function"><span class="keyword">function</span> <span class="title">info</span><span class="params">(msg)</span> {</span>
    <span class="keyword">this</span>.__log(<span class="string">'INFO'</span>, arguments);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <h3 id="debug">debug</h3>
<p>Info useful to developers for debugging the application, not useful
during operations.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  debug: <span class="function"><span class="keyword">function</span> <span class="title">debug</span><span class="params">(msg)</span> {</span>
    <span class="keyword">this</span>.__log(<span class="string">'DEBUG'</span>, arguments);
  }
};</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
